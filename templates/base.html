{% load static %}
<!DOCTYPE html>
<html lang="sw" class="scroll-smooth">
<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% block title %}Al-Hadid Foundation{% endblock %}</title>

  {# Basic SEO #}
  <meta name="description" content="We serve orphans, empower women with Islamic teachings, develop mosques, and support premature babies in hospitals.">
  <meta name="keywords" content="charity, foundation, health, education, community, Al Hadid">
  <meta name="author" content="Al-Hadid Foundation">

  {# Browser / OS theming (chosen color: primary DEFAULT = #155e2b) #}
  <meta name="theme-color" content="#155e2b" />
  <meta name="msapplication-TileColor" content="#155e2b" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  {# Open Graph / Twitter (social preview) #}
  <meta property="og:title" content="{% block og_title %}Al-Hadid Foundation{% endblock %}" />
  <meta property="og:description" content="We serve orphans, empower women with Islamic teachings, develop mosques, and support premature babies in hospitals." />
  <meta property="og:image" content="{% static 'images/logo.png' %}" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Al-Hadid Foundation" />
  <meta name="twitter:description" content="Supporting orphans, health and education in our community." />
  <meta name="twitter:image" content="{% static 'images/logo.png' %}" />

  {# Favicons (static files) #}
  <link rel="icon" href="{% static 'images/logo.png' %}" />
  <link rel="icon" type="image/png" href="{% static 'images/favicon-96x96.png' %}" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="{% static 'images/favicon.svg' %}" />
  <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" />
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}" />
  <link rel="manifest" href="{% static 'images/site.webmanifest' %}" />

  {# Stylesheets #}
  <link rel="stylesheet" href="{% static 'css/tw.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">


  <!-- Hide mobile drawer & hamburger on desktop (presentation only) -->
  <style>
    @media (min-width:768px){
      #mobileMenuOpen{ display:none !important; }
      #mobileNav{ display:none !important; }
    }
  </style>

  <script>
    // set theme early
    (function () {
      const s = localStorage.getItem('theme');
      if (s === 'dark' || (!s && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <style id="meta-insta-fonts">
    @media (max-width: 767.98px) {
      /* Global small type (Instagram/Meta-like) */
      html { font-size: 14px; }           /* default 16px → 14px */
      body { font-size: 1rem; line-height: 1.5; }

      /* Compact heading sizes */
      h1 { font-size: 1.5rem; }           /* ~21px */
      h2 { font-size: 1.25rem; }          /* ~17.5px */
      h3 { font-size: 1.125rem; }         /* ~15.75px */
      h4 { font-size: 1rem; }             /* 14px */
      h5 { font-size: .9375rem; }         /* ~13.1px */
      h6 { font-size: .875rem; }          /* ~12.25px */
    }
  </style>

</head>

<body class="bg-white dark:bg-slate-950 text-slate-800 dark:text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/90 dark:bg-slate-950/80 backdrop-blur border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <!-- BRAND -->
      <a href="{% url 'website:home' %}" class="flex items-center gap-2 min-w-0 select-none">
        <img src="{% static 'images/logo.png' %}" alt="Al-Hadid"
             style="width:60px;height:60px;object-fit:contain;border-radius:6px;display:block" />
        <span class="font-semibold leading-none whitespace-nowrap">Al-Hadid Foundation</span>
      </a>

      <!-- Desktop nav -->
      {% with current=active|default:request.resolver_match.url_name|default:'' %}
      <nav class="hidden md:grid md:auto-cols-max md:grid-flow-col md:gap-6 text-sm justify-center">
        <a href="{% url 'website:home' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'home' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'home' %}aria-current="page"{% endif %}>Home</a>

        <a href="{% url 'website:news_events' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'news_events' or current == 'news_detail' or current == 'event_detail' or current == 'news' or current == 'events' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'news_events' or current == 'news_detail' or current == 'event_detail' or current == 'news' or current == 'events' %}aria-current="page"{% endif %}>
          News & Events
        </a>

        <a href="{% url 'website:gallery' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'gallery' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'gallery' %}aria-current="page"{% endif %}>Gallery</a>

        <a href="{% url 'website:about' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'about' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'about' %}aria-current="page"{% endif %}>About</a>

        <a href="{% url 'website:donate' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'donate' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'donate' %}aria-current="page"{% endif %}>Donate</a>

        <a href="{% url 'website:contact' %}"
          class="hover:text-emerald-600 dark:hover:text-emerald-400 {% if current == 'contact' %}text-emerald-700 dark:text-emerald-400 font-semibold border-b-2 border-emerald-600 dark:border-emerald-400 pb-0.5{% endif %}"
          {% if current == 'contact' %}aria-current="page"{% endif %}>Contact</a>
      </nav>
      {% endwith %}


      <!-- Right controls -->
      <div class="flex items-center gap-3">
        <!-- Hamburger (mobile only via CSS above + JS guard) -->
        <button id="mobileMenuOpen"
                class="rounded-xl border border-slate-300 dark:border-slate-700 p-2"
                aria-label="Fungua menyu" aria-controls="mobileNav" aria-expanded="false">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/>
          </svg>
        </button>

        <button id="themeToggle" class="rounded-xl border border-slate-300 dark:border-slate-700 p-2" aria-label="Toggle theme">
          <svg id="sun" class="h-5 w-5 hidden dark:inline" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364-1.414-1.414M7.05 7.05 5.636 5.636m12.728 0-1.414 1.414M7.05 16.95l-1.414 1.414"/><circle cx="12" cy="12" r="4"/></svg>
          <svg id="moon" class="h-5 w-5 dark:hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
        {% if request.user.is_authenticated and request.user.is_staff %}
          <a href="{% url 'admin_panel:dashboard' %}" class="hidden sm:inline-flex items-center rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 text-sm">Dashboard</a>
        {% else %}
          <a href="{% url 'admin_panel:login' %}" class="hidden sm:inline-flex items-center rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 text-sm">Login</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Mobile Sidebar (JS controls state; CSS is appearance only) -->
  <div id="mobileNav">
    <div id="mobileNavOverlay"></div>
    <aside id="mobileNavPanel" class="shadow-2xl">
      <div class="h-16 px-4 flex items-center justify-between border-b border-slate-200 dark:border-slate-800">
        <div class="flex items-center">
          <img src="{% static 'images/logo.png' %}" alt=""
               style="width:32px;height:32px;object-fit:contain;border-radius:6px;display:block" />
          <span class="font-semibold leading-none">Al-Hadid Foundation</span>
        </div>
        <button id="mobileMenuClose" class="rounded-xl border border-slate-300 dark:border-slate-700 p-2" aria-label="Funga menyu">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.3 19.71 2.89 18.3 9.18 12 2.89 5.71 4.3 4.29 10.59 10.6l6.3-6.31z"/>
          </svg>
        </button>
      </div>

      {% with current=active|default:request.resolver_match.url_name|default:'' %}
      <nav class="px-4 py-4 space-y-1 text-base">
        <a href="{% url 'website:home' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'home' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'home' %}aria-current="page"{% endif %}>Home</a>

        <a href="{% url 'website:news_events' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'news_events' or current == 'news_detail' or current == 'event_detail' or current == 'news' or current == 'events' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'news_events' or current == 'news_detail' or current == 'event_detail' or current == 'news' or current == 'events' %}aria-current="page"{% endif %}>
          News & Events
        </a>

        <a href="{% url 'website:gallery' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'gallery' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'gallery' %}aria-current="page"{% endif %}>Gallery</a>

        <a href="{% url 'website:about' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'about' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'about' %}aria-current="page"{% endif %}>About</a>

        <a href="{% url 'website:donate' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'donate' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'donate' %}aria-current="page"{% endif %}>Donate</a>

        <a href="{% url 'website:contact' %}"
          class="block px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 {% if current == 'contact' %}bg-slate-100 dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 font-semibold{% endif %}"
          {% if current == 'contact' %}aria-current="page"{% endif %}>Contact</a>

        {% if request.user.is_authenticated and request.user.is_staff %}
          <a href="{% url 'admin_panel:dashboard' %}" class="mt-4 block text-center rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2">Dashboard</a>
        {% else %}
          <a href="{% url 'admin_panel:login' %}" class="mt-4 block text-center rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2">Login</a>
        {% endif %}
      </nav>
      {% endwith %}

    </aside>
  </div>

  <!-- Main -->
  <main class="min-h-[60vh]">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer (unaletwa vilevile) -->
  <footer class="mt-12 border-t border-slate-200 dark:border-slate-800 bg-slate-50/60 dark:bg-slate-900/40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 grid md:grid-cols-4 gap-8">
      <div>
        <div class="flex items-center gap-3 mb-3">
          <img src="{% static 'images/logo.png' %}" class="h-9 w-9" alt="">
          <span class="font-semibold">Al-Hadid Foundation</span>
        </div>
        <p class="text-sm text-slate-600 dark:text-slate-300">
          Faith-driven, non-profit organization uplifting vulnerable communities through compassion and service.
        </p>
      </div>
      <div>
        <h4 class="font-semibold mb-3">Quick Links</h4>
        <ul class="space-y-2 text-sm">
          <li><a class="hover:text-emerald-600" href="{% url 'website:about' %}">About Us</a></li>
          <li><a class="hover:text-emerald-600" href="{% url 'website:news_events' %}">News & Events</a></li>
          <li><a class="hover:text-emerald-600" href="{% url 'website:donate' %}">Donate</a></li>
          <li><a class="hover:text-emerald-600" href="{% url 'website:contact' %}">Contact</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3">Contact</h4>
        <ul class="text-sm space-y-1">
          <li>Morogoro — Tanzania</li>
          <li>Phone: <a class="hover:text-emerald-600" href="tel:+255758150976">+255 758 150 976</a></li>
          <li>Email: <a class="hover:text-emerald-600" href="mailto:info@alhadid.org">info@alhadid.org</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-3">Follow</h4>
        <div class="flex gap-3">
          {% if site_settings.facebook_url %}
          <a href="{{ site_settings.facebook_url }}" class="p-2 rounded-xl border dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="Facebook">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M13 22v-9h3l1-4h-4V7a1 1 0 0 1 1-1h3V2h-3a5 5 0 0 0-5 5v2H6v4h3v9h4z"/></svg>
          </a>
          {% endif %}
          {% if site_settings.instagram_url %}
          <a href="{{ site_settings.instagram_url }}" class="p-2 rounded-xl border dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="Instagram">
            <i class="bi bi-instagram h-5 w-5" aria-hidden="true"></i>
          </a>
          {% endif %}
          {% if site_settings.twitter_url %}
          <a href="{{ site_settings.twitter_url }}" class="p-2 rounded-xl border dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="X">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h3l-7 8 8 12h-6l-5-7-6 7H2l8-9L2 2h6l5 7 5-7z"/></svg>
          </a>
          {% endif %}
          {% if site_settings.whatsapp_number %}
          <a href="{{ site_settings.whatsapp_number|wa_link }}" class="p-2 rounded-xl border dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="WhatsApp">
            <i class="bi bi-whatsapp h-5 w-5" aria-hidden="true"></i>
          </a>
          {% endif %}
          {% if site_settings.youtube_url %}
          <a href="{{ site_settings.youtube_url }}" class="p-2 rounded-xl border dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="YouTube">
            <i class="bi bi-youtube h-5 w-5" aria-hidden="true"></i>
          </a>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="border-t border-slate-200 dark:border-slate-800 py-4 text-center text-sm text-slate-500 dark:text-slate-400">
      © {{ now|date:"Y" }} Al-Hadid Foundation. All rights reserved.
    </div>
  </footer>

  <!-- WhatsApp Float -->
  {% if site_settings.whatsapp_number %}
  <a href="{{ site_settings.whatsapp_number|wa_link }}" target="_blank" aria-label="WhatsApp"
     class="fixed bottom-5 right-5 rounded-full p-3 shadow-lg bg-emerald-600 hover:bg-emerald-700 text-white">
     <i class="bi bi-whatsapp h-5 w-5" aria-hidden="true"></i>
  </a>
  {% endif %}

  <!-- Scripts -->
  <script>
    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', function(){
      const html = document.documentElement;
      const dark = html.classList.toggle('dark');
      localStorage.setItem('theme', dark ? 'dark' : 'light');
    });

    // ===== Off-canvas (JS controls show/hide) =====
    (function () {
      const drawer  = document.getElementById('mobileNav');
      const panel   = document.getElementById('mobileNavPanel');
      const overlay = document.getElementById('mobileNavOverlay');
      const openBtn = document.getElementById('mobileMenuOpen');
      const closeBtn= document.getElementById('mobileMenuClose');

      if (!drawer || !panel || !overlay || !openBtn || !closeBtn) return;

      // Base inline styles (hidden)
      Object.assign(drawer.style, { position:'fixed', inset:'0', display:'none', zIndex:'1000' });
      Object.assign(overlay.style,{ position:'absolute', inset:'0', background:'rgba(0,0,0,0.6)', opacity:'0' });
      Object.assign(panel.style,  {
        position:'absolute', top:'0', bottom:'0', left:'0',
        width:'85vw', maxWidth:'380px', height:'100%',
        transform:'translateX(-100%)', willChange:'transform',
        overflowY:'auto', boxSizing:'border-box',
        paddingBottom:'16px'
      });
      overlay.style.zIndex = '1000';
      panel.style.zIndex   = '1001';

      // Solid panel bg (white/dark) so isiwe transparent
      function setPanelTheme(){
        const dark = document.documentElement.classList.contains('dark');
        panel.style.backgroundColor = dark ? '#0b1220' : '#ffffff';   // slate-950 like
        panel.style.color           = dark ? 'rgb(226,232,240)' : '#0f172a';
      }
      setPanelTheme();
      document.getElementById('themeToggle').addEventListener('click', () => {
        setTimeout(setPanelTheme, 0);
      });

      let lastOverflow = '';

      function trapFocus(e) {
        if (e.key !== 'Tab') return;
        const focusables = panel.querySelectorAll('a[href],button:not([disabled]),textarea,input,select,[tabindex]:not([tabindex="-1"])');
        if (!focusables.length) return;
        const first = focusables[0], last = focusables[focusables.length - 1];
        if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
        else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
      }

      function isDesktop(){ return window.matchMedia('(min-width:768px)').matches; }

      function openMenu() {
        if (isDesktop()) return; // block desktop
        setPanelTheme();
        drawer.style.display = 'block';
        lastOverflow = document.body.style.overflow;
        document.body.style.overflow = 'hidden';

        overlay.style.transition = 'opacity 220ms ease';
        panel.style.transition   = 'transform 260ms ease';

        requestAnimationFrame(() => {
          overlay.style.opacity = '1';
          panel.style.transform = 'translateX(0)';
        });

        openBtn.setAttribute('aria-expanded', 'true');
        document.addEventListener('keydown', onKeydown);
        document.addEventListener('keydown', trapFocus);
        closeBtn.focus();
      }

      function closeMenu(immediate=false) {
        if (immediate){
          overlay.style.transition = panel.style.transition = '';
          overlay.style.opacity = '0';
          panel.style.transform = 'translateX(-100%)';
          drawer.style.display = 'none';
        } else {
          overlay.style.opacity = '0';
          panel.style.transform = 'translateX(-100%)';
          const done = ()=>{ drawer.style.display='none'; panel.removeEventListener('transitionend', done); };
          panel.addEventListener('transitionend', done);
        }
        openBtn.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = lastOverflow || '';
        document.removeEventListener('keydown', onKeydown);
        document.removeEventListener('keydown', trapFocus);
      }

      function onKeydown(e){ if (e.key === 'Escape') closeMenu(); }

      // Events
      openBtn.addEventListener('click', openMenu);
      closeBtn.addEventListener('click', ()=>closeMenu());
      overlay.addEventListener('click', ()=>closeMenu());
      panel.querySelectorAll('a[href]').forEach(a => a.addEventListener('click', ()=>closeMenu()));

      // Guard on resize (ensure hidden on desktop)
      function syncMode(){
        if (isDesktop()){
          openBtn.style.display = 'none';
          if (drawer.style.display !== 'none') closeMenu(true);
        } else {
          openBtn.style.display = '';
        }
      }
      window.addEventListener('resize', syncMode);
      syncMode();
    })();
  </script>
</body>
</html>
