{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full" data-theme="light">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Set New Password — Al-Hadid</title>
  <link rel="stylesheet" href="{% static 'css/tw.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    /* ---------- Reusable effects (consistent with Login/Forgot) ---------- */
    .logo-pulse{animation:pulse-subtle 2s ease-in-out infinite}
    @keyframes pulse-subtle{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.02);opacity:.95}}
    .card-entrance{animation:slideUp .6s ease-out}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .glassmorphism{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2)}
    .dark .glassmorphism{background:rgba(15,23,42,.8);border:1px solid rgba(255,255,255,.1)}

    .floating-particles{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .particle{position:absolute;width:6px;height:6px;background:rgba(255,255,255,.12);border-radius:50%;animation:float 6s ease-in-out infinite,bubbleGlow 3s ease-in-out infinite alternate}
    @keyframes float{0%,100%{transform:translateY(0) rotate(0);opacity:.55}50%{transform:translateY(-22px) rotate(180deg);opacity:1}}
    @keyframes bubbleGlow{0%{filter:drop-shadow(0 0 0 rgba(255,255,255,0))}100%{filter:drop-shadow(0 0 8px rgba(255,255,255,.25))}}

    /* ---------- Floating labels (same pattern as Forgot) ---------- */
    .floating-group{position:relative}
    .floating-input{padding-top:1.25rem;height:3rem}
    .floating-label{
      position:absolute;left:1rem;top:50%;transform:translateY(-50%);
      font-size:.95rem;line-height:1rem;color:rgb(100 116 139);
      pointer-events:none;transition:all .16s ease;background:transparent;padding:0 .25rem;
    }
    /* label MUST be immediately after input for the + selector to work */
    .floating-input:focus + .floating-label,
    .floating-input:not(:placeholder-shown) + .floating-label{
      top:.35rem;transform:translateY(0);font-size:.75rem;color:rgb(16 185 129);
    }
    .dark .floating-label{color:rgb(148 163 184)}
    .dark .floating-input:focus + .floating-label,
    .dark .floating-input:not(:placeholder-shown) + .floating-label{color:rgb(52 211 153)}

    /* Alerts (toasts) */
    .alert{ @apply rounded-xl border px-3 py-2 text-sm shadow-lg; }
    .alert-success{ @apply text-emerald-700 dark:text-emerald-200 bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-800; }
    .alert-error{ @apply text-rose-700 dark:text-rose-200 bg-rose-50 dark:bg-rose-900/30 border-rose-200 dark:border-rose-800; }
    .alert-warning{ @apply text-amber-700 dark:text-amber-200 bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-800; }
    .alert-info{ @apply text-sky-700 dark:text-sky-200 bg-sky-50 dark:bg-sky-900/30 border-sky-200 dark:border-sky-800; }

    .btn{ @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold transition; }
    .btn-primary{ @apply bg-emerald-600 hover:bg-emerald-700 active:bg-emerald-800 text-white shadow-sm; }
    .error-text{ @apply mt-1 text-xs font-semibold text-rose-600 dark:text-rose-400; }

    /* Django help text tidy */
    .help-text{font-size:.75rem;color:rgb(71 85 105)}
    .dark .help-text{color:rgb(148 163 184)}
    .help-text ul{margin-top:.25rem;padding-left:1rem;list-style:disc}
    .help-text li{margin-top:.25rem}
  </style>
</head>

<body class="h-full bg-gradient-to-br from-emerald-700 to-slate-900 dark:from-slate-950 dark:to-slate-900 relative">
  <!-- Background particles -->
  <div class="floating-particles" aria-hidden="true">
    <div class="particle" style="left:10%;bottom:12%;animation-delay:0s"></div>
    <div class="particle" style="left:22%;bottom:18%;animation-delay:.8s"></div>
    <div class="particle" style="left:35%;bottom:10%;animation-delay:1.6s"></div>
    <div class="particle" style="left:48%;bottom:20%;animation-delay:.4s"></div>
    <div class="particle" style="left:60%;bottom:14%;animation-delay:1.2s"></div>
    <div class="particle" style="left:72%;bottom:22%;animation-delay:.2s"></div>
    <div class="particle" style="left:84%;bottom:16%;animation-delay:1.4s"></div>
  </div>

  {% if messages %}
  <div id="toast-stack" class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-[min(92vw,28rem)] space-y-2" aria-live="polite">
    {% for message in messages %}
      <div class="toast alert
        {% if message.tags == 'success' %} alert-success {% endif %}
        {% if message.tags == 'error' %} alert-error {% endif %}
        {% if message.tags == 'warning' %} alert-warning {% endif %}
        {% if message.tags == 'info' %} alert-info {% endif %}
      ">
        <div class="flex items-start gap-3">
          <div class="flex-1">{{ message }}</div>
          <button type="button" class="toast-close -m-1 rounded-lg px-2 text-slate-500 hover:text-slate-800 dark:text-slate-300 dark:hover:text-white" aria-label="Dismiss">✕</button>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <main class="min-h-screen flex items-center justify-center p-4 relative z-10">
    <section class="w-full max-w-md glassmorphism rounded-2xl shadow-2xl card-entrance">
      <header class="px-8 pt-8 pb-4 text-center">
        <img src="{% static 'images/logo.png' %}" alt="Al-Hadid" class="mx-auto h-16 w-auto mb-4 logo-pulse" />
        <h1 class="text-2xl font-semibold text-slate-100 tracking-tight">Set New Password</h1>
        <p class="text-sm text-emerald-50/90 mt-1 font-medium">Al-Hadid Foundation</p>
      </header>

      <div class="px-8 pb-8">
        {% if form.non_field_errors %}
          <div class="mb-3 alert alert-error">
            {{ form.non_field_errors|striptags }}
          </div>
        {% endif %}

        <form method="post" class="space-y-5" novalidate>
          {% csrf_token %}

          <!-- New Password (floating + eye; label immediately after input) -->
          {% if form.new_password2.errors %}
            <p class="error-text" style="color: red; padding-bottom: 5px;">{{ form.new_password2.errors|striptags }}</p>
          {% endif %}
          <div class="floating-group">
            <input
              id="new_password1"
              name="new_password1"
              type="password"
              required
              autocomplete="new-password"
              placeholder=" "
              class="floating-input block w-full rounded-xl border-2 border-slate-300 dark:border-slate-700
                     bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100
                     px-4 pt-6 pb-2 pr-12 placeholder-transparent
                     focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
              aria-describedby="pw1-help"
            />
            <label for="new_password1" class="floating-label" style="padding-bottom: 125px;">New password</label>
            <!-- Eye toggle INSIDE input area; placed after label to preserve input+label adjacency above -->
            <button type="button"
              class="js-toggle-password absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400"
              aria-label="Show password" data-target="#new_password1">
              <i class="bi bi-eye" style="margin-bottom: 20px; float: left;"></i>
            </button>

            <div class="mt-6 mb-4">
              {% if form.new_password1.errors %}
                <p class="error-text">{{ form.new_password1.errors|striptags }}</p>
              {% endif %}
              {% if form.new_password1.help_text %}
                <div id="pw1-help" class="help-text mt-2">{{ form.new_password1.help_text|safe }}</div>
              {% endif %}
            </div>
          </div>

          <!-- Confirm New Password (floating + eye) -->
          <div class="floating-group">
            <input
              id="new_password2"
              name="new_password2"
              type="password"
              required
              autocomplete="new-password"
              placeholder=" "
              class="floating-input block w-full rounded-xl border-2 border-slate-300 dark:border-slate-700
                     bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100
                     px-4 pt-6 pb-2 pr-12 placeholder-transparent
                     focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition"
            />
            <label for="new_password2" class="m-4 floating-label">Confirm new password</label>
            <button type="button"
              class="js-toggle-password absolute inset-y-0 right-0 flex items-center pr-3 text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400"
              aria-label="Show password" data-target="#new_password2">
              <i class="bi bi-eye"></i>
            </button>
          </div>

          <button class="btn mt-6 btn-primary w-full" type="submit">Save New Password</button>
        </form>

        <div class="mt-6 text-center">
          <a href="{% url 'admin_panel:login' %}" class="text-sm text-slate-200/90 hover:text-white underline-offset-4 hover:underline">
            ← Back to Sign In
          </a>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Theme
    (function(){
      const s=localStorage.getItem('theme');
      if(s==='dark') document.documentElement.classList.add('dark');
      document.documentElement.style.transition='background-color .3s ease';
    })();

    // Password eye toggles (keeps button inside input area)
    (function(){
      document.addEventListener('mousedown', e => {
        if (e.target.closest('.js-toggle-password')) e.preventDefault(); // don't steal focus
      });
      document.addEventListener('click', e => {
        const btn = e.target.closest('.js-toggle-password'); if(!btn) return;
        const input = document.querySelector(btn.getAttribute('data-target')); if(!input) return;
        const icon = btn.querySelector('i');
        const showing = input.type === 'text';
        input.type = showing ? 'password' : 'text';
        icon.classList.toggle('bi-eye', showing);
        icon.classList.toggle('bi-eye-slash', !showing);
        btn.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
        btn.style.transform='scale(.9)'; setTimeout(()=>btn.style.transform='scale(1)',100);
      });
    })();

    // Toasts
    (function () {
      const stack=document.getElementById('toast-stack'); if(!stack) return;
      stack.querySelectorAll('.toast').forEach((t,i)=>{
        const timeout=4000+i*800; const timer=setTimeout(()=>t.remove(),timeout);
        t.addEventListener('click',e=>{if(e.target.closest('.toast-close')){clearTimeout(timer); t.remove();}});
      });
    })();

    // Focus first field
    requestAnimationFrame(()=>{const el=document.getElementById('new_password1'); if(el && (document.activeElement===document.body || !document.activeElement)) el.focus();});
  </script>
</body>
</html>
