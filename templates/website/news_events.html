{% extends "base.html" %}
{% block title %}News & Events — {{ site_settings.site_name|default:"Al-Hadid" }}{% endblock %}
{% block content %}

<style>
  .gold-underline::after{
    content:""; display:block; width:72px; height:3px; margin-top:12px; border-radius:999px;
    background:linear-gradient(90deg,#cab26b,#d1ad51);
  }
  .news-card{ 
    position:relative; 
    overflow:hidden; 
    transition:transform .3s ease, box-shadow .3s ease;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(209,173,81,0.1);
  }
  .dark .news-card{
    background: rgba(2,6,23,0.95);
    border: 1px solid rgba(209,173,81,0.15);
  }
  .news-card:hover{ 
    transform:translateY(-8px);
    box-shadow: 0 20px 40px rgba(16,24,40,.15);
  }
  .dark .news-card:hover{
    box-shadow: 0 20px 40px rgba(0,0,0,.4);
  }
  .news-card::before{
    content:""; position:absolute; inset:0 0 auto 0; height:4px; opacity:.85;
    background:linear-gradient(90deg,#d1ad51,var(--tw-primary,#10b981));
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }
  .news-card:hover::before{
    transform: scaleX(1);
  }

  .hero-news{
    position:relative;
    overflow:hidden;
    background: linear-gradient(135deg, rgba(209,173,81,0.05), rgba(16,185,129,0.05));
  }
  .hero-news::before{
    content:"";
    position:absolute;
    inset:0;
    background-image:
      repeating-linear-gradient(45deg, rgba(209,173,81,.08) 0 2px, transparent 2px 20px),
      repeating-linear-gradient(-45deg, rgba(16,185,129,.06) 0 1px, transparent 1px 25px);
    pointer-events:none;
  }

  .category-badge{
    background: linear-gradient(135deg, rgba(209,173,81,0.1), rgba(16,185,129,0.1));
    border: 1px solid rgba(209,173,81,0.2);
    transition: all 0.3s ease;
  }
  .category-badge:hover{
    background: linear-gradient(135deg, rgba(209,173,81,0.2), rgba(16,185,129,0.2));
    transform: scale(1.05);
  }

  .featured-news{
    background: linear-gradient(135deg, rgba(209,173,81,0.08), rgba(255,255,255,0.95));
    border: 2px solid rgba(209,173,81,0.15);
  }
  .dark .featured-news{
    background: linear-gradient(135deg, rgba(209,173,81,0.12), rgba(2,6,23,0.95));
    border: 2px solid rgba(209,173,81,0.2);
  }

  .islamic-pattern{
    background-image:
      radial-gradient(circle at 25% 25%, rgba(209,173,81,0.1) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, rgba(16,185,129,0.08) 0%, transparent 50%);
  }
</style>

<!-- ===================== HERO SECTION ===================== -->
<section class="hero-news border-b border-emerald-100 dark:border-slate-800 relative py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="text-center">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gold/10 text-gold mb-6">
        <i class="fa-solid fa-newspaper"></i> 
        <span class="text-sm font-medium">Stay Updated</span>
      </div>
      
      <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">
        News & <span class="text-gold">Events</span>
      </h1>
      
      <p class="text-lg text-slate-600 dark:text-slate-300 mb-8 max-w-3xl mx-auto">
        Stay informed about our latest programs, community impact stories, and upcoming events. 
        Discover how Al-Hadid Foundation continues to serve communities across Tanzania.
      </p>
      
      <div class="flex flex-wrap justify-center gap-4">
        <div class="category-badge rounded-full px-4 py-2">
          <span class="text-sm font-medium text-slate-800 dark:text-slate-200">
            <i class="fa-solid fa-heart text-gold mr-2"></i>Community Impact
          </span>
        </div>
        <div class="category-badge rounded-full px-4 py-2">
          <span class="text-sm font-medium text-slate-800 dark:text-slate-200">
            <i class="fa-solid fa-calendar text-emerald-600 mr-2"></i>Upcoming Events
          </span>
        </div>
        <div class="category-badge rounded-full px-4 py-2">
          <span class="text-sm font-medium text-slate-800 dark:text-slate-200">
            <i class="fa-solid fa-bullhorn text-blue-600 mr-2"></i>Announcements
          </span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===================== ISLAMIC INSPIRATION ===================== -->
<section class="py-12 islamic-pattern">
  <div class="max-w-4xl mx-auto px-4 text-center">
    <div class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-2xl p-8 border border-gold/10">
      <p class="text-2xl md:text-3xl font-semibold text-slate-800 dark:text-slate-200 mb-4">
        "وَبَشِّرِ الصَّابِرِينَ"
      </p>
      <p class="text-lg text-slate-700 dark:text-slate-300 mb-3">
        "And give good tidings to the patient"
      </p>
      <p class="text-sm text-gold font-medium">— Quran 2:155</p>
    </div>
  </div>
</section>

<section class="max-w-7xl mx-auto px-4 py-16">
  <!-- FEATURED NEWS -->
  {% if news %}
    <div class="mb-16">
      <h2 class="text-2xl font-semibold gold-underline mb-8">Featured Story</h2>
      <div class="featured-news rounded-2xl p-8 md:p-12">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <div class="flex items-center gap-3 mb-4">
              <span class="bg-gold/20 text-gold px-3 py-1 rounded-full text-sm font-medium">
                <i class="fa-solid fa-star mr-1"></i>Featured
              </span>
              <span class="text-sm text-slate-500 dark:text-slate-400">
                {% firstof news.0.created_at news.0.updated_at "" as n_dt %}{{ n_dt }}
              </span>
            </div>
            <h3 class="text-2xl md:text-3xl font-bold mb-4 text-slate-800 dark:text-slate-200">
              {{ news.0.title }}
            </h3>
            <p class="text-slate-600 dark:text-slate-300 mb-6 leading-relaxed">
              {% firstof news.0.content news.0.body news.0.text "" as n_txt %}{{ n_txt|striptags|truncatewords:40 }}
            </p>
            <a href="{% url 'website:news_detail' news.0.pk %}" class="inline-flex items-center gap-2 bg-gold hover:bg-gold/90 text-white px-6 py-3 rounded-xl font-medium transition-colors">
              Read Full Story
              <i class="fa-solid fa-arrow-right"></i>
            </a>
          </div>
          <div class="relative">
            {% if news.0.image %}
              <img src="{{ news.0.image.url }}" class="rounded-2xl w-full h-64 md:h-80 object-cover shadow-lg" alt="">
            {% else %}
              <div class="rounded-2xl w-full h-64 md:h-80 bg-gradient-to-br from-gold/20 to-emerald-100 flex items-center justify-center">
                <i class="fa-solid fa-newspaper text-6xl text-gold/50"></i>
              </div>
            {% endif %}
            <div class="absolute -bottom-4 -right-4 bg-white dark:bg-slate-800 rounded-xl p-3 shadow-lg border border-gold/20">
              <div class="text-xs text-slate-500 dark:text-slate-400">Impact Story</div>
              <div class="font-semibold text-gold">Community Focus</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- NEWS SECTION -->
  <div class="mb-16">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-2xl font-semibold gold-underline">Latest News</h2>
      <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400">
        <i class="fa-solid fa-clock"></i>
        <span>Updated regularly</span>
      </div>
    </div>
    
    <div id="newsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {% if news %}
        {% for n in news %}
        <article class="news-card rounded-2xl overflow-hidden group">
          <div class="relative">
            {% if n.image %}
              <img src="{{ n.image.url }}" class="h-48 w-full object-cover group-hover:scale-105 transition-transform duration-300" alt="">
            {% else %}
              <div class="h-48 w-full bg-gradient-to-br from-gold/20 to-emerald-100 flex items-center justify-center">
                <i class="fa-solid fa-newspaper text-3xl text-gold/50"></i>
              </div>
            {% endif %}
            <div class="absolute top-4 left-4">
              <span class="bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm text-gold px-3 py-1 rounded-full text-xs font-medium">
                News
              </span>
            </div>
          </div>
          
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <i class="fa-solid fa-calendar-alt text-gold text-sm"></i>
              <span class="text-xs text-slate-500 dark:text-slate-400">
                {% firstof n.created_at n.updated_at "" as n_dt %}{{ n_dt }}
              </span>
            </div>
            
            <h3 class="font-semibold text-lg mb-3 text-slate-800 dark:text-slate-200 group-hover:text-gold transition-colors">
              {{ n.title }}
            </h3>
            
            <p class="text-sm text-slate-600 dark:text-slate-300 mb-4 leading-relaxed">
              {% firstof n.content n.body n.text "" as n_txt %}{{ n_txt|striptags|truncatewords:20 }}
            </p>
            
            <div class="flex items-center justify-between">
              <a href="{% url 'website:news_detail' n.pk %}" class="text-primary hover:text-gold font-medium text-sm inline-flex items-center gap-1 transition-colors">
                Read more 
                <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
              </a>
              <div class="flex items-center gap-1 text-xs text-slate-400">
                <i class="fa-solid fa-eye"></i>
                <span>{{ forloop.counter }}2 views</span>
              </div>
            </div>
          </div>
        </article>
        {% endfor %}
      {% else %}
        <div class="md:col-span-3 text-center py-16">
          <div class="w-24 h-24 bg-gold/20 rounded-full mx-auto mb-6 flex items-center justify-center">
            <i class="fa-solid fa-newspaper text-3xl text-gold/50"></i>
          </div>
          <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200 mb-2">No News Yet</h3>
          <p class="text-slate-600 dark:text-slate-300">We're working on bringing you the latest updates. Check back soon!</p>
        </div>
      {% endif %}
    </div>

    <!-- minimal pager (client-side chunks 6 per page) -->
    <div id="newsPager" class="grid grid-flow-col auto-cols-max gap-2 justify-center mt-8">
      <button id="newsPrev" class="px-3 py-1.5 text-sm rounded-lg border border-slate-300 dark:border-slate-700 disabled:opacity-40">Prev</button>
      <span id="newsPageIndicator" class="px-2 py-1.5 text-sm text-slate-600 dark:text-slate-300">1/1</span>
      <button id="newsNext" class="px-3 py-1.5 text-sm rounded-lg border border-slate-300 dark:border-slate-700 disabled:opacity-40">Next</button>
    </div>
  </div>

  <!-- EVENTS SECTION -->
  <div>
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-2xl font-semibold gold-underline">Upcoming Events</h2>
      <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400">
        <i class="fa-solid fa-calendar-plus"></i>
        <span>Join us</span>
      </div>
    </div>
    
    <div id="eventsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {% if events %}
        {% for e in events %}
        <article class="news-card rounded-2xl overflow-hidden group">
          <div class="relative">
            {% if e.image %}
              <img src="{{ e.image.url }}" class="h-48 w-full object-cover group-hover:scale-105 transition-transform duration-300" alt="">
            {% else %}
              <div class="h-48 w-full bg-gradient-to-br from-emerald-100 to-blue-100 flex items-center justify-center">
                <i class="fa-solid fa-calendar-days text-3xl text-emerald-600/50"></i>
              </div>
            {% endif %}
            <div class="absolute top-4 left-4">
              <span class="bg-emerald-600 text-white px-3 py-1 rounded-full text-xs font-medium">
                Event
              </span>
            </div>
            {% if e.location %}
              <div class="absolute top-4 right-4">
                <span class="bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm text-slate-700 dark:text-slate-300 px-2 py-1 rounded-full text-xs">
                  <i class="fa-solid fa-map-marker-alt mr-1"></i>{{ e.location }}
                </span>
              </div>
            {% endif %}
          </div>
          
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <i class="fa-solid fa-clock text-emerald-600 text-sm"></i>
              <span class="text-xs text-slate-500 dark:text-slate-400">
                {% firstof e.event_date e.created_at "" as e_dt %}{{ e_dt }}
              </span>
            </div>
            
            <h3 class="font-semibold text-lg mb-3 text-slate-800 dark:text-slate-200 group-hover:text-emerald-600 transition-colors">
              {{ e.title }}
            </h3>
            
            <p class="text-sm text-slate-600 dark:text-slate-300 mb-4 leading-relaxed">
              {% firstof e.description e.summary e.body e.content e.text "" as e_txt %}{{ e_txt|striptags|truncatewords:20 }}
            </p>
            
            <div class="flex items-center justify-between">
              <a href="{% url 'website:event_detail' e.pk %}" class="text-emerald-600 hover:text-emerald-700 font-medium text-sm inline-flex items-center gap-1 transition-colors">
                View details 
                <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
              </a>
              <div class="flex items-center gap-1 text-xs text-slate-400">
                <i class="fa-solid fa-users"></i>
                <span>Join us</span>
              </div>
            </div>
          </div>
        </article>
        {% endfor %}
      {% else %}
        <div class="md:col-span-3 text-center py-16">
          <div class="w-24 h-24 bg-emerald-100 rounded-full mx-auto mb-6 flex items-center justify-center">
            <i class="fa-solid fa-calendar-days text-3xl text-emerald-600/50"></i>
          </div>
          <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200 mb-2">No Events Scheduled</h3>
          <p class="text-slate-600 dark:text-slate-300">We're planning exciting events for our community. Stay tuned!</p>
        </div>
      {% endif %}
    </div>

    <!-- minimal pager (client-side chunks 6 per page) -->
    <div id="eventsPager" class="grid grid-flow-col auto-cols-max gap-2 justify-center mt-8">
      <button id="eventsPrev" class="px-3 py-1.5 text-sm rounded-lg border border-slate-300 dark:border-slate-700 disabled:opacity-40">Prev</button>
      <span id="eventsPageIndicator" class="px-2 py-1.5 text-sm text-slate-600 dark:text-slate-300">1/1</span>
      <button id="eventsNext" class="px-3 py-1.5 text-sm rounded-lg border border-slate-300 dark:border-slate-700 disabled:opacity-40">Next</button>
    </div>
  </div>

  <!-- NEWSLETTER SIGNUP -->
  <div class="bg-gradient-to-br from-gold/5 to-emerald-50/30 dark:from-gold/10 dark:to-slate-800 rounded-2xl p-8 md:p-12 text-center">
    <div class="max-w-2xl mx-auto">
      <div class="w-16 h-16 bg-gold/20 rounded-full mx-auto mb-6 flex items-center justify-center">
        <i class="fa-solid fa-envelope text-gold text-2xl"></i>
      </div>
      <h3 class="text-2xl font-semibold mb-4 text-slate-800 dark:text-slate-200">Stay Connected</h3>
      <p class="text-slate-600 dark:text-slate-300 mb-8">
        Get the latest news, event updates, and impact stories delivered to your inbox. 
        Join our community of supporters making a difference.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
        <input type="email" placeholder="Enter your email" 
               class="flex-1 px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-green-500 focus:border-green-500">
        <button class="bg-green-600 hover:bg-green-600/90 text-white px-6 py-3 rounded-xl font-medium transition-colors">
          Subscribe
        </button>
      </div>
      <p class="text-xs text-slate-500 dark:text-slate-400 mt-4">
        We respect your privacy. Unsubscribe at any time.
      </p>
    </div>
  </div>
</section>

<script>
  (function(){
    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    document.querySelectorAll('.news-card').forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(30px)';
      el.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
      observer.observe(el);
    });

    document.querySelectorAll('.category-badge').forEach(badge => {
      badge.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05) translateY(-2px)';
      });
      badge.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1) translateY(0)';
      });
    });
  })();
</script>

<!-- Minimal pagination (client-side: 6 per page) -->
<script>
  (function(){
    function setupPager(listId, prevId, nextId, labelId, perPage){
      const list = document.getElementById(listId);
      if(!list) return;
      const items = Array.from(list.children);
      const prev = document.getElementById(prevId);
      const next = document.getElementById(nextId);
      const label= document.getElementById(labelId);

      const totalPages = Math.max(1, Math.ceil(items.length / perPage));
      const pagerWrap = (prev || next || label) ? (prev?.parentElement || next?.parentElement || label?.parentElement) : null;
      if (pagerWrap && totalPages <= 1) { pagerWrap.style.display = 'none'; }

      let page = 1;

      function render(){
        items.forEach((el, i) => {
          const p = Math.floor(i / perPage) + 1;
          el.style.display = (p === page) ? '' : 'none';
        });
        if(prev) prev.disabled = page <= 1;
        if(next) next.disabled = page >= totalPages;
        if(label) label.textContent = page + '/' + totalPages;
      }

      function scrollTop(){
        list.scrollIntoView({behavior:'smooth', block:'start'});
      }

      prev && prev.addEventListener('click', function(){
        if(page > 1){ page--; render(); scrollTop(); }
      });
      next && next.addEventListener('click', function(){
        if(page < totalPages){ page++; render(); scrollTop(); }
      });

      render();
    }

    setupPager('newsList',   'newsPrev',   'newsNext',   'newsPageIndicator',   6);
    setupPager('eventsList', 'eventsPrev', 'eventsNext', 'eventsPageIndicator', 6);
  })();
</script>

{% endblock %}
